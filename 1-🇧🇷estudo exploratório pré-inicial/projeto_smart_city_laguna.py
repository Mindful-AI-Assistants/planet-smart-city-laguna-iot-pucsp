# -*- coding: utf-8 -*-
"""projeto_Smart_City_Laguna.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1tINY4YufFgB-jFBUGrxd5jLq5F6Ga88A

AnÃ¡lise e OtimizaÃ§Ã£o do Consumo de Energia Residencial por Ambiente

1. IntroduÃ§Ã£o

Objetivo:

entender o consumo de energia elÃ©trica em residÃªncias dividido por cÃ´modos e identificar padrÃµes para otimizar uso e reduzir desperdÃ­cios.

ImportÃ¢ncia:

energia Ã© um dos maiores custos fixos, e uma gestÃ£o eficiente traz economia financeira e ambiental.

Dados:

consumo diÃ¡rio por cÃ´modo (quartos, sala, cozinha, piscina) e consumo total (KW/H) em 211 dias.

2. Metodologia


AnÃ¡lise exploratÃ³ria:

estudamos dados de consumo por cÃ´modo, identificando mÃ©dias, variaÃ§Ãµes e perfis tÃ­picos.

ClusterizaÃ§Ã£o:

agrupamos residÃªncias em clusters de consumo (baixo, equilibrado, alto) para personalizar recomendaÃ§Ãµes.

Modelagem preditiva:

construÃ­mos um modelo de regressÃ£o linear para prever o consumo total a partir do consumo individual de cada cÃ´modo.

AvaliaÃ§Ã£o:

medimos desempenho do modelo com mÃ©tricas MAE e RÂ² para garantir previsÃµes confiÃ¡veis.

RecomendaÃ§Ãµes:

baseadas nos clusters, sugerimos aÃ§Ãµes prÃ¡ticas para cada perfil.

3. Resultados e AnÃ¡lise

ClusterizaÃ§Ã£o:

identificamos 3 grupos principais:

Baixo consumo â€” residÃªncias com consumo controlado e eficiente.

Consumo equilibrado â€” consumo mÃ©dio com algumas Ã¡reas elevadas.

Alto consumo â€” consumo elevado, especialmente em sala, cozinha ou piscina.

Modelo de regressÃ£o linear: RÂ² de 0,86 indica alta capacidade preditiva.

Sala tem maior impacto no consumo total.

AnÃ¡lise temporal:

identificamos picos e sazonalidades para futuras intervenÃ§Ãµes programadas.

4. ConclusÃµes de CiÃªncia de Dados


Os dados possibilitaram segmentar residÃªncias e prever consumo com alta precisÃ£o.

O modelo Ã© simples, interpretÃ¡vel e indica os cÃ´modos que mais influenciam o consumo total.

A anÃ¡lise permitiu criar perfis que facilitam recomendaÃ§Ãµes direcionadas.

5. Impacto de NegÃ³cio e RecomendaÃ§Ãµes


Com base nos clusters, o cliente pode oferecer planos personalizados, descontos e incentivos para reduzir consumo.

SugestÃµes incluem automaÃ§Ã£o, sensores de presenÃ§a, uso consciente e tarifas diferenciadas.

A abordagem pode reduzir custos e aumentar satisfaÃ§Ã£o do cliente, alÃ©m de contribuir para sustentabilidade.
"""

import pandas as pd
import locale
import pandas as pd
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_absolute_error, r2_score

# Carregar o arquivo Excel com mÃºltiplas abas
file_path = "Consumo_de_Energia_Analise.xlsx"
xls = pd.ExcelFile(file_path)

# Listar os nomes das abas
sheet_names = xls.sheet_names
sheet_names

# Carregar os dados da aba "Sheet1"
df = xls.parse('Sheet1')

# Exibir as primeiras linhas para anÃ¡lise inicial
df

df.info()

# Mapeamento de abreviaÃ§Ãµes de meses em portuguÃªs para nÃºmeros
meses_pt = {
    'jan': '01', 'fev': '02', 'mar': '03', 'abr': '04',
    'mai': '05', 'jun': '06', 'jul': '07', 'ago': '08',
    'set': '09', 'out': '10', 'nov': '11', 'dez': '12'
}

# Converter datas de '01/jan' para '01/01/2025'
df['Data'] = df['Data'].str.lower().replace(meses_pt, regex=True)
df['Data'] = pd.to_datetime(df['Data'] + '/2025', format='%d/%m/%Y')

# EstatÃ­sticas descritivas
summary = df.describe()

# CorrelaÃ§Ã£o entre as variÃ¡veis
correlation = df.corr(numeric_only=True)

# VisualizaÃ§Ã£o: histograma das variÃ¡veis
fig, axes = plt.subplots(nrows=2, ncols=3, figsize=(16, 8))
axes = axes.flatten()
for i, col in enumerate(df.columns[1:]):  # Ignora a coluna 'Data'
    sns.histplot(df[col], kde=True, ax=axes[i], bins=10)
    axes[i].set_title(f'DistribuiÃ§Ã£o - {col}')
    axes[i].set_xlabel(col)

plt.tight_layout()
plt.suptitle("DistribuiÃ§Ã£o das VariÃ¡veis de Consumo", fontsize=16, y=1.02)
plt.show()

summary, correlation

"""ğŸ“ˆ Resumo EstatÃ­stico das VariÃ¡veis
MÃ©dia de consumo diÃ¡rio: 1188,3 kWh

MÃ¡ximo: 1667 kWh, MÃ­nimo: 644 kWh

CÃ´modos mais acionados:

Quarto1: mÃ©dia de 9,7 vezes/dia

Cozinha e Piscina: ~9,3 vezes/dia

Sala tem a maior variaÃ§Ã£o de uso (atÃ© 17 vezes/dia)

Os dados estÃ£o bem distribuÃ­dos â€” sem grandes distorÃ§Ãµes ou outliers evidentes.

ğŸ“Š CorrelaÃ§Ã£o com o consumo total (KW/H):
Sala tem a maior correlaÃ§Ã£o com o consumo total: 0.55

Depois vÃªm Quarto1 (0.52) e Piscina (0.43)

Quarto2 e Cozinha tambÃ©m influenciam, mas com menor peso.

A Cozinha tem correlaÃ§Ã£o negativa com a Piscina (-0.08), sugerindo uso alternado em alguns dias.

ğŸ§  Insights de CiÃªncia de Dados + NegÃ³cio
VocÃª pode construir um modelo de regressÃ£o linear para prever o consumo com base nas ativaÃ§Ãµes por cÃ´modo.

Uma clusterizaÃ§Ã£o K-means tambÃ©m pode separar dias em grupos de uso leve, moderado e intenso â€” Ã³timo para personalizar alertas ou otimizar tarifas.

Do ponto de vista ESG e Smart City, esses dados podem orientar:

Campanhas educativas por cÃ´modo (ex: â€œUso consciente da salaâ€)

AutomaÃ§Ã£o via IoT (ex: alertas quando uso da piscina exceder padrÃ£o)
"""

# Plotar consumo total ao longo do tempo
plt.figure(figsize=(14, 6))
plt.plot(df['Data'], df['KW/H'], label='Consumo Total (KW/H)', color='blue', linewidth=2)
plt.title('EvoluÃ§Ã£o do Consumo Total de Energia')
plt.xlabel('Data')
plt.ylabel('KW/H')
plt.grid(True)
plt.legend()
plt.tight_layout()
plt.show()

# Agora plotar o consumo por cÃ´modo no mesmo grÃ¡fico, para comparar
plt.figure(figsize=(16, 8))
for comodo in ['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina']:
    plt.plot(df['Data'], df[comodo], label=comodo)

plt.title('Consumo de Energia por CÃ´modo ao Longo do Tempo')
plt.xlabel('Data')
plt.ylabel('Consumo')
plt.grid(True)
plt.legend()
plt.tight_layout()
plt.show()

# Definir variÃ¡veis preditoras (X) e variÃ¡vel alvo (y)
X = df[['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina']]
y = df['KW/H']

# Separar treino e teste
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# RegressÃ£o linear
modelo = LinearRegression()
modelo.fit(X_train, y_train)

# PrediÃ§Ã£o
y_pred = modelo.predict(X_test)

# AvaliaÃ§Ã£o do modelo
print("Coeficientes:", modelo.coef_)
print("Intercepto:", modelo.intercept_)
print("Erro mÃ©dio absoluto (MAE):", mean_absolute_error(y_test, y_pred))
print("RÂ² (coeficiente de determinaÃ§Ã£o):", r2_score(y_test, y_pred))

"""ğŸ“Œ Resultados do Modelo

âœ… Coeficientes:

Sala: +25.79 â†’ maior impacto no consumo total

Piscina: +24.45

Cozinha: +23.49

Quarto1 / Quarto2: tambÃ©m relevantes, cerca de +23.3 e +23.1

Isso indica que cada vez que um ambiente Ã© utilizado, o consumo estimado aumenta cerca de 23 a 26 kWh, com a sala sendo a mais impactante.

ğŸ¯ Intercepto:

49.88 kWh: o consumo base estimado mesmo com zero ativaÃ§Ãµes â€” pode refletir consumo contÃ­nuo (geladeiras, standby etc.)

ğŸ“‰ Erro MÃ©dio Absoluto (MAE):

57.74 kWh â†’ baixo em relaÃ§Ã£o Ã  mÃ©dia total (~1188 kWh), indicando boa precisÃ£o.

ğŸ“ˆ RÂ² (Coeficiente de determinaÃ§Ã£o):

0.86 â†’ o modelo explica 86% da variaÃ§Ã£o no consumo, um valor muito bom para aplicaÃ§Ãµes prÃ¡ticas.


"""

plt.scatter(y_test, y_pred, alpha=0.7)
plt.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 'r--')  # Linha identidade
plt.xlabel('Consumo Real (KW/H)')
plt.ylabel('Consumo Previsto (KW/H)')
plt.title('Real vs Previsto - Consumo Total')
plt.show()

from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler
import matplotlib.pyplot as plt
import seaborn as sns

# Dados usados na clusterizaÃ§Ã£o
X = df[['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina']]

# NormalizaÃ§Ã£o (fundamental para KMeans)
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# Encontrar nÃºmero ideal de clusters (opcional)
inertia = []
for k in range(1, 10):
    km = KMeans(n_clusters=k, random_state=42)
    km.fit(X_scaled)
    inertia.append(km.inertia_)

plt.plot(range(1, 10), inertia, marker='o')
plt.title('MÃ©todo do Cotovelo')
plt.xlabel('NÃºmero de clusters')
plt.ylabel('InÃ©rcia')
plt.show()

# Aplicar KMeans com 3 clusters (ajuste conforme o grÃ¡fico do cotovelo)
kmeans = KMeans(n_clusters=3, random_state=42)
df['Cluster'] = kmeans.fit_predict(X_scaled)

# VisualizaÃ§Ã£o
sns.pairplot(df, hue='Cluster', vars=['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina'], palette='tab10')
plt.suptitle("PadrÃµes de Uso Agrupados por Cluster", y=1.02)
plt.show()

# === PERFIL DE CADA CLUSTER ===
perfil_clusters = df.groupby('Cluster')[['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina', 'KW/H']].mean()

def nomear_cluster(row):
    media_kw = df['KW/H'].mean()

    # Consumo total
    if row['KW/H'] < media_kw * 0.75:
        consumo_total = 'ğŸ”µ Baixo Consumo'
    elif row['KW/H'] > media_kw * 1.25:
        consumo_total = 'ğŸ”´ Alto Consumo'
    else:
        consumo_total = 'ğŸŸ¡ Consumo Equilibrado'

    # Verificar cÃ´modos com consumo alto
    altos = []
    for comodo in ['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina']:
        if row[comodo] > df[comodo].mean() * 1.2:  # 20% acima da mÃ©dia daquele cÃ´modo
            altos.append(comodo)

    # Montar nome do cluster com base nos cÃ´modos de alto consumo
    if consumo_total == 'ğŸ”µ Baixo Consumo':
        return consumo_total

    if consumo_total == 'ğŸŸ¡ Consumo Equilibrado' and len(altos) == 0:
        return consumo_total

    if consumo_total == 'ğŸŸ¡ Consumo Equilibrado' and len(altos) > 0:
        return f"ğŸŸ  Consumo Elevado em {', '.join(altos)}"

    if consumo_total == 'ğŸ”´ Alto Consumo':
        if len(altos) == 0:
            return consumo_total
        else:
            return f"ğŸ”´ Alto Consumo (Em {', '.join(altos)})"

perfil_clusters['Perfil'] = perfil_clusters.apply(nomear_cluster, axis=1)

# Mapeamento para chaves base do dicionÃ¡rio recomendacoes
def mapear_perfil_para_chave(perfil):
    if perfil == 'ğŸ”µ Baixo Consumo':
        return perfil
    if perfil == 'ğŸŸ¡ Consumo Equilibrado':
        return perfil
    if perfil.startswith('ğŸŸ  Consumo Elevado'):
        # Aqui vocÃª pode escolher um nome genÃ©rico ou identificar cÃ´modo especÃ­fico
        # Por exemplo, se sÃ³ quiser geral:
        return 'ğŸŸ  Consumo Elevado'
    if perfil.startswith('ğŸ”´ Alto Consumo'):
        # Pode mapear por cÃ´modos mais frequentes ou usar geral
        # Vamos tentar diferenciar por cÃ´modo principal (primeiro da lista)
        # Exemplo de extraÃ§Ã£o do primeiro cÃ´modo:
        import re
        encontrados = re.findall(r'\b\w+\b', perfil)  # pega palavras
        # Pegando o primeiro cÃ´modo apÃ³s "Em"
        if 'Em' in perfil:
            idx = perfil.index('Em') + 3
            # extrair o texto depois de "Em "
            texto = perfil[idx:]
            principal = texto.split(',')[0].strip()
            if principal == 'Sala' or principal == 'Piscina':
                return 'ğŸ”´ Alto Consumo (Sala/Piscina)'
            elif principal == 'Cozinha':
                return 'ğŸ”´ Alto Consumo (Cozinha)'
            else:
                return 'ğŸ”´ Alto Consumo'
        else:
            return 'ğŸ”´ Alto Consumo'
    return perfil  # fallback

recomendacoes = {
    'ğŸ”µ Baixo Consumo': [
        "âœ… Manter boas prÃ¡ticas jÃ¡ adotadas.",
        "ğŸ Oferecer recompensas ou descontos (gamificaÃ§Ã£o).",
        "ğŸ”‹ Incentivar uso de energia solar / microgeraÃ§Ã£o."
    ],
    'ğŸŸ¡ Consumo Equilibrado': [
        "ğŸ”Œ Automatizar desligamento de equipamentos em horÃ¡rios fixos.",
        "ğŸ•µï¸ Instalar sensores de presenÃ§a em quartos e sala.",
        "ğŸ“Š Enviar relatÃ³rios semanais de uso comparativo."
    ],
    'ğŸŸ  Consumo Elevado': [
        "ğŸ›ï¸ Automatizar luzes e eletrÃ´nicos nos cÃ´modos com consumo elevado.",
        "ğŸ•µï¸ Instalar sensores de presenÃ§a especÃ­ficos para os cÃ´modos.",
        "ğŸ“Š Acompanhar o uso para identificar picos desnecessÃ¡rios."
    ],
    'ğŸ”´ Alto Consumo (Sala/Piscina)': [
        "ğŸ’§ Agendar funcionamento da bomba da piscina fora do pico.",
        "ğŸ’¡ Incentivar uso consciente da iluminaÃ§Ã£o e eletrÃ´nicos.",
        "ğŸ§  Sugerir automaÃ§Ã£o e adesÃ£o Ã  tarifa branca."
    ],
    'ğŸ”´ Alto Consumo (Cozinha)': [
        "ğŸ³ Verificar equipamentos de cozinha para consumo excessivo.",
        "â° Controlar horÃ¡rios de uso de forno e geladeira.",
        "ğŸ’¡ Incentivar uso eficiente da iluminaÃ§Ã£o."
    ]
}

# Exibir os perfis e recomendaÃ§Ãµes
for cluster_id, row in perfil_clusters.iterrows():
    print(f"\n=== Cluster {cluster_id} - {row['Perfil']} ===")
    print("ğŸ“Š Perfil mÃ©dio:")
    print(row[['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina', 'KW/H']])
    print("\nğŸ’¡ RecomendaÃ§Ãµes:")

    chave = mapear_perfil_para_chave(row['Perfil'])

    if chave in recomendacoes:
        for item in recomendacoes[chave]:
            print("-", item)
    else:
        print("- Sem recomendaÃ§Ãµes especÃ­ficas para este perfil.")

"""# RelatÃ³rio de Perfis de Consumo por Cluster

---

## === Cluster 0 - ğŸŸ¡ Consumo Equilibrado ===

### ğŸ“Š Perfil mÃ©dio:
| Ambiente  | Consumo MÃ©dio (kWh) |
| --------- | ------------------- |
| Quarto1   | 10.00               |
| Quarto2   | 11.19               |
| Sala      | 8.25                |
| Cozinha   | 8.89                |
| Piscina   | 6.93                |
| **Total (KW/H)** | **1129.99**      |

### ğŸ’¡ RecomendaÃ§Ãµes:
- ğŸ”Œ Automatizar desligamento de equipamentos em horÃ¡rios fixos.
- ğŸ•µï¸ Instalar sensores de presenÃ§a em quartos e sala.
- ğŸ“Š Enviar relatÃ³rios semanais de uso comparativo.

---

## === Cluster 1 - ğŸŸ  Consumo Elevado em Sala, Cozinha ===

### ğŸ“Š Perfil mÃ©dio:
| Ambiente  | Consumo MÃ©dio (kWh) |
| --------- | ------------------- |
| Quarto1   | 11.46               |
| Quarto2   | 9.74                |
| Sala      | 12.51               |
| Cozinha   | 11.23               |
| Piscina   | 9.89                |
| **Total (KW/H)** | **1368.13**      |

### ğŸ’¡ RecomendaÃ§Ãµes:
- ğŸ›ï¸ Automatizar luzes e eletrÃ´nicos nos cÃ´modos com consumo elevado.
- ğŸ•µï¸ Instalar sensores de presenÃ§a especÃ­ficos para os cÃ´modos.
- ğŸ“Š Acompanhar o uso para identificar picos desnecessÃ¡rios.

---

## === Cluster 2 - ğŸŸ  Consumo Elevado em Piscina ===

### ğŸ“Š Perfil mÃ©dio:
| Ambiente  | Consumo MÃ©dio (kWh) |
| --------- | ------------------- |
| Quarto1   | 7.93                |
| Quarto2   | 7.76                |
| Sala      | 8.15                |
| Cozinha   | 8.20                |
| Piscina   | 11.43               |
| **Total (KW/H)** | **1100.40**      |

### ğŸ’¡ RecomendaÃ§Ãµes:
- ğŸ’§ Monitorar o uso da piscina e bombas.
- â° Programar horÃ¡rios eficientes para funcionamento.
- ğŸ’¡ Incentivar uso consciente da iluminaÃ§Ã£o externa.

---

*Fim do relatÃ³rio.*

"""