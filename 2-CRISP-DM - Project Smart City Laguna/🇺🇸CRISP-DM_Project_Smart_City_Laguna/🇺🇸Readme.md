<br>
# Digital Twin for Residential Energy Monitoring and Optimization - SmartHouse

## ğŸ¯ Project Objective

Develop a solution based on data science and artificial intelligence to **monitor, predict, and optimize electricity consumption in a smart home** (Smart City Laguna). The project simulates sensor data per room and uses machine learning to anticipate consumption patterns and propose savings actions.

<br>

## ğŸ“Š Dataset Used

A **simulated** dataset was used, containing daily records with the following variables:

- `Data`: Measurement day
- `KW/H`: Total energy consumption in kWh
- `Quarto1`, `Quarto2`, `Sala`, `Cozinha`, `Piscina`: Number of sensor activations in each room
- `GeraÃ§Ã£o Solar`: Energy generated by solar panels (simulated)

<br>

## ğŸ” Business Question

> â€œHow to predict daily energy consumption based on room-by-room behavior and, from this, propose automatic measures for savings and energy efficiency?â€

<br>

## ğŸ§ª Methodology and Steps Taken

1. **Data import and visualization**  
Reading the spreadsheet with `pandas` and validating formats.

2. **Preprocessing**  
    - Converting the `Data` column to `datetime` format.  
    - Creating the variable `Dia_ordinal` for modeling.  
    - Calculating average consumption per activation per room.  
    - Simulating solar generation and projecting future consumption.

3. **Predictive Modeling**  
A **Linear Regression** model was trained to estimate consumption (`KW/H`) based on total activations per room. Next-day prediction was also implemented.

4. **Visualizations**  
    - Time series charts with `matplotlib`/`seaborn`.  
    - Ranking of highest-consuming rooms.  
    - Representations of activations by cluster.  
    - Interactive Streamlit dashboard for real-time visualization (optional).

5. **Report Export**  
Automatic generation of PDF reports with relevant data, charts, and forecasts.

<br>


## ğŸ“ˆ Results Obtained

- The regression model showed good ability to predict consumption based on activations.  
- It was identified that **Sala (Living Room)** and **Cozinha (Kitchen)** are the rooms with the greatest impact on consumption.  
- The **Piscina (Pool)**, although with few activations, shows high average consumption per activation, indicating waste; it was removed from the model since the Laguna project is aimed at social housing and does not include pools.  
- Solar generation can significantly offset consumption during peak hours if well managed.

<br>

## âœ… Conclusions and Recommendations

- **Automate shutdowns** in high-use areas such as living room and kitchen to achieve immediate savings.  
- **Schedule pool usage times** to mitigate unjustified consumption peaks.  
- **Leverage solar generation** to balance appliance use during peak generation hours.  
- **Implement alerts** when daily consumption targets are exceeded.

<br>

## ğŸ§¾ Deliverables

- Streamlit application with real-time sensor visualization.  
- PDF report with consumption metrics and suggestions.  
- Notebook with the full data pipeline, predictive model, and visual analyses.

<br>

## ğŸ‘¥ Target Audience

This project was developed for an external client interested in **residential energy efficiency** solutions, with potential expansion to condominiums, buildings, and smart cities.

<br>

ğŸ“Œ *This report was prepared based on data science practices applied to residential energy consumption contexts and aims to facilitate decision-making for the end client.*


<br>

## ğŸ““ Code Pipeline


<br>

### **Cell 1 â€” Import libraries**

```python
import locale
import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.decomposition import PCA
from sklearn.cluster import KMeans
from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_absolute_error, r2_score, mean_squared_error
```


<br>

### **Cell 2 â€” Data loading**

```python
# Change the path according to your environment
file_path = "/Users/fabicampanari/Desktop/Project Planet Smart City Laguna/2-CRISP-DM - Project Smart City Laguna/ğŸ‡§ğŸ‡· CRISP-DM_Projeto_Smart_City_Laguna/Consumo_de_Energia_Analise.xlsx"
xls = pd.ExcelFile(file_path)
sheet_names = xls.sheet_names
print(sheet_names)
df = xls.parse('Sheet1')
print(df.head())
df.info()
```

<br>

### **Cell 3 â€” Date preprocessing**

```python
meses_pt = {
    'jan': '01', 'fev': '02', 'mar': '03', 'abr': '04',
    'mai': '05', 'jun': '06', 'jul': '07',
}
df['Data'] = df['Data'].astype(str)
df['Data'] = df['Data'].str.lower().replace(meses_pt, regex=True)
df['Data'] = pd.to_datetime(df['Data'] + '/2025', format='%d/%m/%Y')
```


<br>

### **Cell 4 â€” Descriptive statistics and correlation**

```python
summary = df.describe()
correlation = df.corr(numeric_only=True)
print(summary)
print(correlation)
```

<br>

### **Cell 5 â€” [PLOT 1] Variable distributions**

```python
fig, axes = plt.subplots(2, 3, figsize=(15, 10))
axes = axes.flatten()
cols = df.columns[1:7]
for i, col in enumerate(cols):
    sns.histplot(df[col], kde=True, ax=axes[i], bins=10)
    axes[i].set_title(f'Distribution - {col}')
    axes[i].set_xlabel(col)
plt.tight_layout()
plt.suptitle("Variable Distributions", fontsize=16, y=1.02)
plt.show()
```

**Insert here to visualize the distribution of consumption and activations.**

<br>

### **Cell 6 â€” [PLOT 2] Total consumption over time**

```python
plt.figure(figsize=(14, 6))
plt.plot(df['Data'], df['KW/H'], label='Total Consumption (KW/H)', color='blue', linewidth=2)
plt.title('Total Energy Consumption Over Time')
plt.xlabel('Date')
plt.ylabel('KW/H')
plt.grid(True)
plt.legend()
plt.tight_layout()
plt.show()
```

**Shows the evolution of energy consumption over time.**

<br>

### **Cell 7 â€” Weekly grouping and [PLOT 3] Weekly activations per room**

```python
df['Semana'] = df['Data'].dt.to_period('W').apply(lambda r: r.start_time)
df_semana = df.groupby('Semana')[['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina']].sum()
df_semana.plot(figsize=(12, 6), marker='o')
plt.title('Weekly Activations per Room')
plt.ylabel('Number of Activations')
plt.xlabel('Week')
plt.xticks(rotation=45)
plt.grid(True)
plt.tight_layout()
plt.show()
```

**Shows the sum of activations per week in each room.**

<br>

### **Cell 8 â€” [PLOT 4] Correlation between activations and consumption**

```python
correlations = df[['KW/H', 'Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina']].corr()['KW/H'][1:]
plt.figure(figsize=(10, 5))
sns.barplot(x=correlations.index, y=correlations.values, palette='Oranges_r')
plt.title('Correlation between Activations and Energy Consumption (kWh)')
plt.ylabel('Correlation')
plt.xlabel('Room')
plt.tight_layout()
plt.show()
```

**Shows which rooms most impact total consumption.**

<br>

### **Cell 9 â€” Predictive modeling (Linear Regression) and evaluation**

```python
X = df[['Quarto1', 'Quarto2', 'Sala', 'Cozinha']]
y = df['KW/H']
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
model = LinearRegression()
model.fit(X_train, y_train)
y_pred = model.predict(X_test)
mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)
print("Mean Squared Error (MSE):", round(mse, 2))
print("RÂ² Score:", round(r2, 2))
```


<br>

### **Cell 10 â€” [PLOT 5] Actual vs Predicted Consumption**

```python
plt.figure(figsize=(10, 5))
plt.scatter(y_test, y_pred, alpha=0.7)
plt.plot([y.min(), y.max()], [y.min(), y.max()], 'r--')
plt.xlabel("Actual Consumption (kWh)")
plt.ylabel("Predicted Consumption (kWh)")
plt.title("Actual vs Predicted Consumption")
plt.grid(True)
plt.tight_layout()
plt.show()
```

**Visually evaluates the predictive model's performance.**

<br>

### **Cell 11 â€” Model coefficients**

```python
coefficients = pd.Series(model.coef_, index=X.columns)
print("\nContribution of each room to the prediction (coefficients):")
print(coefficients.sort_values(ascending=False))
```

**Shows the weight of each room in the consumption prediction.**

<br>

### **Cell 12 â€” Calculate activation percentages per room**

```python
df['Total_activations'] = df[['Quarto1', 'Quarto2', 'Sala', 'Cozinha']].sum(axis=1)
for room in ['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'Piscina']:
    df[f'{room}_pct'] = df[room] / df['Total_activations']
```


<br>

### **Cell 13 â€” [PLOT 6] Elbow Method for KMeans**

```python
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)
inertia = []
for k in range(1, 10):
    km = KMeans(n_clusters=k, random_state=42)
    km.fit(X_scaled)
    inertia.append(km.inertia_)
plt.figure(figsize=(8,5))
plt.plot(range(1, 10), inertia, marker='o')
plt.title('Elbow Method')
plt.xlabel('Number of clusters')
plt.ylabel('Inertia')
plt.grid(True)
plt.show()
```

**Visually choose the ideal number of clusters.**

---<br>
### **Cell 14 â€” KMeans and [PLOT 7] Pairplot of clusters**

```python
kmeans = KMeans(n_clusters=3, random_state=42)
df['Cluster'] = kmeans.fit_predict(X_scaled)
sns.pairplot(df, hue='Cluster', vars=['Quarto1', 'Quarto2', 'Sala', 'Cozinha'], palette='tab10')
plt.suptitle("Usage Patterns Grouped by Cluster", y=1.02)
plt.show()
```

**Visualizes consumption profile groupings.**

<br>

### **Cell 15 â€” Average profile per cluster and naming**

```python
col_pcts = [f'{c}_pct' for c in ['Quarto1', 'Quarto2', 'Sala', 'Cozinha']]
perfil_clusters = df.groupby('Cluster')[['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'KW/H'] + col_pcts].mean()

def name_cluster(row):
    mean_kw = df['KW/H'].mean()
    if row['KW/H'] < mean_kw * 0.75:
        total_consumption = 'ğŸ”µ Low Consumption'
    elif row['KW/H'] > mean_kw * 1.25:
        total_consumption = 'ğŸ”´ High Consumption'
    else:
        total_consumption = 'ğŸŸ¡ Balanced Consumption'
    high = []
    for room in ['Quarto1', 'Quarto2', 'Sala', 'Cozinha']:
        mean_pct = df[f'{room}_pct'].mean()
        if row[f'{room}_pct'] > mean_pct * 1.2:
            high.append(room)
    if total_consumption == 'ğŸ”µ Low Consumption':
        return total_consumption
    if total_consumption == 'ğŸŸ¡ Balanced Consumption':
        if len(high) == 0:
            return total_consumption
        else:
            return f"ğŸŸ  High Consumption in {', '.join(high)}"
    if total_consumption == 'ğŸ”´ High Consumption':
        if len(high) == 0:
            return total_consumption
        else:
            return f"ğŸ”´ High Consumption (In {', '.join(high)})"

perfil_clusters['Profile'] = perfil_clusters.apply(name_cluster, axis=1)
```


<br>

### **Cell 16 â€” Recommendations dictionary and display by cluster**

```python
def map_profile_to_key(profile):
    if profile == 'ğŸ”µ Low Consumption':
        return profile
    if profile == 'ğŸŸ¡ Balanced Consumption':
        return profile
    if profile.startswith('ğŸŸ  High Consumption'):
        return 'ğŸŸ  High Consumption'
    if profile.startswith('ğŸ”´ High Consumption'):
        if 'In' in profile:
            idx = profile.index('In') + 3
            text = profile[idx:]
            main = text.split(',')[^0].strip()
            if main in ['Sala']:
                return 'ğŸ”´ High Consumption (Sala/Cozinha)'
            elif main == 'Cozinha':
                return 'ğŸ”´ High Consumption (Cozinha)'
            else:
                return 'ğŸ”´ High Consumption'
        else:
            return 'ğŸ”´ High Consumption'
    return profile

recommendations = {
    'ğŸ”µ Low Consumption': [
        "âœ… Maintain current good practices.",
        "ğŸ Offer rewards or discounts (gamification).",
        "ğŸ”‹ Encourage use of solar energy / microgeneration."
    ],
    'ğŸŸ¡ Balanced Consumption': [
        "ğŸ”Œ Automate device shutdown at fixed times.",
        "ğŸ•µï¸ Install presence sensors in bedrooms and living room.",
        "ğŸ“Š Send weekly comparative usage reports."
    ],
    'ğŸŸ  High Consumption': [
        "ğŸ›ï¸ Automate lights and electronics in high-consumption rooms.",
        "ğŸ•µï¸ Install specific presence sensors for the rooms.",
        "ğŸ“Š Monitor usage to identify unnecessary peaks."
    ],
    'ğŸ”´ High Consumption (Sala/Cozinha)': [
        "ğŸ’§ Schedule kitchen pump operation outside peak hours.",
        "ğŸ’¡ Encourage conscious use of lighting and electronics.",
        "ğŸ§  Suggest automation and white tariff subscription."
    ],
    'ğŸ”´ High Consumption (Cozinha)': [
        "ğŸ³ Check kitchen appliances for excessive consumption.",
        "â° Control oven and refrigerator usage times.",
        "ğŸ’¡ Encourage efficient lighting use."
    ]
}

for cluster_id, row in perfil_clusters.iterrows():
    print(f"\n=== Cluster {cluster_id} - {row['Profile']} ===")
    print("ğŸ“Š Average consumption profile (activations and kWh):")
    print(row[['Quarto1', 'Quarto2', 'Sala', 'Cozinha', 'KW/H']])
    print("\nğŸ“ˆ Average percentage of activations per room (%):")
    print((row[col_pcts] * 100).round(2))
    print("\nğŸ’¡ Recommendations:")
    key = map_profile_to_key(row['Profile'])
    if key in recommendations:
        for rec in recommendations[key]:
            print("-", rec)
    else:
        print("- No specific recommendations for this profile.")
```


<br>

### **Cell 17 â€” [PLOT 8] Boxplot of consumption by cluster**

```python
plt.figure(figsize=(7,5))
sns.boxplot(x='Cluster', y='KW/H', data=df)
plt.title('Consumption Distribution (KW/H) by Cluster')
plt.show()
```

**Shows consumption variation by cluster.**

<br>

### **Cell 18 â€” [PLOT 9] Heatmap of percentages by cluster**

```python
heatmap_data = perfil_clusters[col_pcts] * 100
plt.figure(figsize=(8, 5))
sns.heatmap(heatmap_data, annot=True, cmap='YlGnBu', fmt=".2f")
plt.title('Percentage of Activations per Room (%)')
plt.xlabel('Rooms')
plt.ylabel('Cluster')
plt.show()
```

**Visualizes the distribution of activations by cluster.**

<br>

### **Cell 19 â€” [PLOT 10] Radar chart of rooms by cluster**

```python
categories = ['Quarto1', 'Quarto2', 'Sala', 'Cozinha']
angles = np.linspace(0, 2 * np.pi, len(categories), endpoint=False).tolist()
angles += angles[:1]
plt.figure(figsize=(10, 8))
for i, row in perfil_clusters.iterrows():
    values = [row[cat] for cat in categories]
    values += values[:1]
    plt.polar(angles, values, label=f'Cluster {i}')
plt.xticks(angles[:-1], categories)
plt.title('Radar of Rooms by Cluster')
plt.legend()
plt.show()
```

**Compares the activation profile of each cluster.**

<br>

### **Cell 20 â€” [PLOT 11] Cluster visualization with PCA**

```python
pca = PCA(n_components=2)
X_pca = pca.fit_transform(X_scaled)
df_plot = pd.DataFrame(X_pca, columns=['Component 1', 'Component 2'])
df_plot['Cluster'] = df['Cluster']
plt.figure(figsize=(8,6))
for cluster in df_plot['Cluster'].unique():
    plt.scatter(
        df_plot[df_plot['Cluster'] == cluster]['Component 1'],
        df_plot[df_plot['Cluster'] == cluster]['Component 2'],
        label=f'Cluster {cluster}'
    )
plt.title('Cluster Visualization with PCA')
plt.xlabel('Component 1')
plt.ylabel('Component 2')
plt.legend()
plt.grid(True)
plt.show()
```

**Reduces dimensionality to visualize clusters in 2D.**

<br>

## ğŸ“Š Interpretation of Graphs and Profiles

- **Variable Distribution**: Shows how activations and consumption are distributed.  
- **Temporal Evolution**: Allows identification of consumption trends over the days.  
- **Weekly Activations**: Helps visualize patterns by room.  
- **Correlation**: Shows the strength of the relationship between activations and consumption.  
- **Actual vs Predicted Consumption**: Evaluates the quality of the predictive model.  
- **Clustering**: Identifies groups with similar behavior for personalized recommendations.

<br>

## ğŸ’¡ Recommendations by Profile

| Profile | Main Recommendations |
| :-- | :-- |
| ğŸ”µ Low Consumption | Maintain good practices, encourage solar energy, rewards/gamification |
| ğŸŸ¡ Balanced Consumption | Automate shutdowns, install presence sensors, comparative reports |
| ğŸŸ  High Consumption | Automate lights/electronics, specific presence sensors, monitor peaks |
| ğŸ”´ High Consumption (Living Room/Kitchen) | Schedule pump outside peak, conscious lighting use, suggest automation and time-of-use tariff |
| ğŸ”´ High Consumption (Kitchen) | Check equipment, control usage times, encourage lighting efficiency |

<br>

## ğŸ§­ Conclusion

The project enables identifying consumption patterns, forecasting future use, and recommending actions for greater energy efficiency, customizing recommendations according to each residenceâ€™s usage profile.

<br>

**Note:**  
Adjust the Excel file path (`file_path`) according to your environment.

<br>

**This analysis was prepared based on data science practices applied to residential energy consumption contexts and aims to facilitate decision-making for the end client.**





